# Руководство администратора Sources Parser Platform

## Get Started

1. Скачаем исходный код из репозитория`git clone https://github.com/CuberHuber/NSPK-DI-Sources-Parser-Platform.git` или `git@github.com:CuberHuber/NSPK-DI-Sources-Parser-Platform.git`
2. Перейдем в каталог `cd NSPK-DI-Sources-Parser-Platform`
3. Перейдем на рабочую ветку `git checkout platform-synchronous`
4. `cp .env.dev.example .env`
5. Заполнить `.env` файл по [шаблону](#env-файл)
6. [Настроить](#настройки-master-узла-spp) мастер-узел
7. Поднимем инфраструктуру `make setup-dependencies`
8. Можно запускать main.py (в зависимости от IDE)


## Настройки master-узла SPP

Настройки для мастер-узла находится в [репозитории](configurations) `{project}/configurations` и `.env` [файле](.env).

### .env файл

`.env` [файл](.env) содержит все параметры для Source Parser Platform. 
Общая структура выглядит так
```dotenv
# ===================================
#   Настройки базы данных
# ===================================
...
<В этом разделе сгруппированы переменные и параметры для DB>
...
# ===================================
#   Настройки локального хранилища
# ===================================
...
<В этом разделе сгруппированы переменные и параметры для локальеного хранилища>
...
# ===================================
#   Настройки FTP сервера
# ===================================
...
<В этом разделе сгруппированы переменные и параметры для FTP-сервера>
...
# ===================================
#   Настройки Плагинов
# ===================================
...
<Переменные для плагинов>
...
# ===================================
#   Настройки SPP Master-node
# ===================================
...
<В этом разделе содержатся все главные настройки SPP мастер-узла>
...
```

#### Параметры локального хранилища 

| Переменная            | Описание                                                                                                                                        | Значение по умолчанию |
|:----------------------|-------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|
| `LS_BASE_TEMP_DIR`    | Имя базовой папки, в которой будут хранится все данные локального хранилища. Это папка находится в корне проекта                                | localstorage          |
| `LS_WORK_DIR`         | Базовая внутренняя структура вложенных папок локального хранилища. В этой папке будут находиться все загруженные документы по каждому источнику | spp/sources           |
| `LS_CONTROL_FILENAME` | Имя скрытого файла метаданных о хранящихся документах. Такой файл создается для каждого каталога источника (для каждого источника)              | .control.temp.pkl     |

#### Параметры мастер-узла

| Переменная                            | Описание                                                               | Значение по умолчанию                      |
|:--------------------------------------|------------------------------------------------------------------------|--------------------------------------------|
| `SPP_LOG_FILE_PATH`                   | Путь до конфигурационного файла для Python.Logging библиотеки          | configurations/logger/dev.logger.conf      |
| `SPP_LOG_TEMP_PATH`                   | Путь до папки для хранения логов                                       | logs                                       |
| `VERSION`                             | Текущая версия платформы (dev/prod)                                    | dev                                        |
| `PATH_TO_PROJECT_DIR`                 | Абсолютный путь до директории проекта на хосте                         | `<Path to Project directory>`              |
| `SPP_ABSOLUTE_PATH_TO_PLUGIN_ARCHIVE` | [**_`неизменно`_**] Абсолютный путь до директории архива плагинов      | ${PATH_TO_PROJECT_DIR}\${PL_BASE_TEMP_DIR} |
| `SPP_ABSOLUTE_PATH_TO_LOCAL_STORAGE`  | [**_`неизменно`_**] Абсолютный путь до директории локального хранилища | ${PATH_TO_PROJECT_DIR}\${LS_BASE_TEMP_DIR} |
| `SPP_PLUGIN_CONFIG_FILENAME`          | [**_`Менять запрещается`_**] Имя конфигурационного файла плагина       | SPPfile                                    |


## Настройка и управление основными функциями SPP

### Управление источниками


### Управление плагинами

Для управления плагинами:
- добавление плагина
- удаление плагина
- активация плагина
- деактивация плагина

Нужно изменять таблицу `spp_plugin`. При внесении изменений нужно **внимательно** смотреть на 3 ключевые ненулевые колонки:

| Ключ         | Значение                  | Описание                                                                                                           |
|--------------|---------------------------|--------------------------------------------------------------------------------------------------------------------|
| `repository` | {owner}/{repository name} | В этот ключ нужно передать ссылку на репозиторий плагина по шаблону. Например: `CuberHuber/NSPK-DI-SPP-plugin-w3c` |
| `active`     | True / False              | Этот тригер говорит платформе, нужно ли обрабатывать этот плагин: `True` если нужно и `False` если не нужно        |
| `source_id`  | Идентификатор источника   |                                                                                                                    |
